# EXAMPLE USAGE:

#   Refer for explanation to following link:
#   https://github.com/evilmartians/lefthook/blob/master/docs/configuration.md
#
 pre-push:
   commands:
     rubocop:
       tags: backend style
       files: git diff --name-only --diff-filter=d $(git merge-base origin/master HEAD)..HEAD
       glob: '*.{rb,rake}'
       run: REVEAL_RUBOCOP_TODO=0 bundle exec rubocop --parallel --force-exclusion {files}

     # Changelog git trailer for the first commit of the branch
     changelog-on-first-commit:
       run: |
         git fetch origin master
         first_commit_message=$(git log --format=%B -n 1 $(git log origin/master..HEAD --pretty=format:"%h" | tail -1))
         if ! echo ${first_commit_message} | grep "Changelog:"; then
           echo Could not find a Changelog: git trailer on the first commit for this branch.
           echo
           echo Please add a trailer by amending the git commit message.
           echo
           echo See https://docs.gitlab.com/ee/development/changelog.html#overview for more info.
           exit 1
         fi
